
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>上传图片</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free HTML5 Template by FREEHTML5.CO" />
	<meta name="keywords" content="free html5, free template, free bootstrap, html5, css3, mobile first, responsive" />
	<meta name="author" content="FREEHTML5.CO" />

  <!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="favicon.ico">

	<!-- Google Webfonts -->
	<!--<link href='http://fonts.useso.com/css?family=Roboto:400,300,100,500' rel='stylesheet' type='text/css'>-->
	<!--<link href='http://fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>-->
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Magnific Popup -->
	<link rel="stylesheet" href="css/magnific-popup.css">
	<!-- Salvattore -->
	<link rel="stylesheet" href="css/salvattore.css">
	<!-- Theme Style -->
	<link rel="stylesheet" href="css/style.css">
	<style type="text/css">
		.img-type li {
			float: left;
			height: 30px;
			background: #fff;
			margin: 0 10px;
			text-align: center;
			border-radius: 4px;
			line-height: 0;
		}
	</style>
	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	</head>
	<body>
		
	<div id="fh5co-offcanvass">
		<a href="#" class="fh5co-offcanvass-close js-fh5co-offcanvass-close">菜单 <i class="icon-cross"></i> </a>
		<h1 class="fh5co-logo"><a class="navbar-brand" href="upload.html">上传图片</a></h1>
		<ul>
			<li class="active"><a href="index.html">首页</a></li>
			<li><a href="login.html">登录</a></li>
			<li><a href="register.html">注册</a></li>
			<li><a href="perfect.html">完善信息</a></li>
			<li><a href="upload.html">上传图片</a></li>
		</ul>
	</div>
	<header id="fh5co-header" role="banner">
		<div class="container">
			<div class="row">
				<div class="col-md-12 base-info" style="position: relative;">
					<a href="#" class="fh5co-menu-btn js-fh5co-menu-btn">菜单<i class="icon-menu"></i></a>
					<a class="navbar-brand" href="index.html">首页</a>
				</div>
			</div>
		</div>
	</header>
	<!-- END .header -->
	
	
	<div id="fh5co-main">
		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2">
					<h2>Contact</h2>
					<div class="fh5co-spacer fh5co-spacer-sm"></div>
						<div class="row">
							<div class="col-md-8">
								<div class="form-group image-upload" style="width:220px;height:260px;border:solid 1px #aaa;position: relative;">
									<p style="position: absolute;left:75px;top:115px;color:#999;font-size:16px;">上传图片</p>
									<form action="/image/upload" method="post" enctype="multipart/form-data" target="newWindow">
										<input type="file" name="file" style="display: block;position:absolute;top:0;left:0;width:100%;height:100%;opacity: 0; " class="form-control input-file">
									</form>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-6">
								<div class="form-group">
									<input type="text" class="form-control input-name" placeholder="图片名字">
								</div>
							</div>
							<div class="col-md-12">
								<span style="color:#000;font-weight: bold;">图片类型：</span>
								<ul class="img-type" style="display:inline-block;margin-left: -15px;list-style: none;overflow: hidden;margin-bottom:20px;vertical-align: top;">
									<li class="btn btn-default active">人物</li>
									<li class="btn btn-default">动物</li>
									<li class="btn btn-default">风景</li>
									<li class="btn btn-default">食物</li>
									<li class="btn btn-default">动漫/卡通</li>
									<li class="btn btn-default">其他</li>
								</ul>
							</div>
							<div class="col-md-12">
								<div class="form-group">
									<input type="email" class="form-control input-keyword" placeholder="图片关键字">
								</div>
								<div class="form-group">
									<textarea name="message" id="message" cols="30" class="form-control input-msg" placeholder="图片介绍" rows="10"></textarea>
								</div>
								<div class="form-group">
									<button type="button" class="btn btn-primary subnit-btn">上传图片</button>
								</div>
							</div>
						</div>

				</div>
        		
        	</div>
       </div>
	</div>

	<iframe id="newWindow" style="display: none;" name="newWindow"></iframe>

	<div class="modal fade" id="myModal" tabindex="-1" role="dialog">
		<div class="modal-dialog modal-sm" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title">提示</h4>
				</div>
				<div class="modal-body">
					<p></p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal" style="margin-bottom:0;">确定</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal-dialog -->
	</div><!-- /.modal -->


	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Magnific Popup -->
	<script src="js/jquery.magnific-popup.min.js"></script>
	<!-- Salvattore -->
	<script src="js/salvattore.min.js"></script>
	<!-- Main JS -->
	<script src="js/main.js"></script>

	<script type="text/javascript">
		var param = {};
		param.type = 1;
		var userId = window.sessionStorage.getItem("userId");
		if(!userId){
			location.href = "login.html";
		}

		$.ajax({
			url:"/user/info?id="+userId,
			dataType:"json",
			type:"GET",
			success:function(data){
				var str = '<p class="user-detail" style="position: absolute;right:380px;top:14px;">' +
						'<img style="margin-top:-7px;border: solid 1px #aaa;width:40px;height:40px;margin-right:15px;border-radius:100%;" src="'+data.body.img+'" />' +
						'<span style="font-size: 16px;color:#000;">'+data.body.username+'</span></p>';
				$(".base-info").append(str);
				$(".user-detail").click(function(){
					location.href = "info.html";
				});
			}
		});

		$(".input-file").change(function(){
			if($("#newWindow").length == 0){
				$("body").append('<iframe id="newWindow" style="display: none;" name="newWindow"></iframe>');
			}
			$(this).parents("form").submit();
			$("#newWindow")[0].onload = function(){
				var str = $("#newWindow").contents().find("body pre").html();
				var json = JSON.parse(str);
				if(json.status == 0){
					json.body = json.body.split("static/")[1];
					param.img = json.body;
					$(".image-upload").css({"background":"url("+json.body+") no-repeat","background-size":"100% 100%"});
				}
				$("#newWindow").empty().remove();
			}
		});
		$(".img-type li").click(function(){
			var index = $(".img-type li").index(this) + 1;
			param.type = index;
			$(this).addClass("active").siblings().removeClass("active");
		});

		$(".subnit-btn").click(function(){
			if(!$(".input-name").val() || !$(".input-keyword").val() || !$(".input-msg").val()){
				$(".modal-body p").html("输入框不能为空");
				$('#myModal').modal();
				return false;
			}
			param.owner = userId;
			param.name = $(".input-name").val();
			param.keyword = $(".input-keyword").val();
			param.indroduction = $(".input-msg").val();
			$.ajax({
				url:"/image/uploadfile",
				dataType:"json",
				data:JSON.stringify(param),
				type:"POST",
				contentType:"application/json",
				success:function(data){
					if(data.status == 0){
						location.href = "index.html";
					}else{
						$(".modal-body p").html(data.msg);
						$('#myModal').modal();
					}
				}
			});
		});
	</script>

	
	</body>
</html>
